---
title: Zeek简介
toc: true
date: 2020-03-12 23:19:16
tags: [IDS, Zeek]
index_img: /img/zeek-logo.png
---

## 1 Overview

Zeek又名Bro，是一个被动的开源网络流量分析器。它主要是一种安全监视器，可深入检查链接上的所有流量以查找可疑活动的迹象。在安全领域以外，Zeek还能够进行性能测量，故障检测等工作。

<!--more-->

1995年劳伦斯伯克利实验室的研究员Vern开始了Bro的开发，并于1996年在实验室进行内部部署，1998年在USENIX安全研讨会进行发表。2003年，美国国家科学基金会（NSF）开始在国际计算机科学研究所（ICSI）上支持Bro的研究和高级开发。2010年NSF通过向ICSI授予SDCI计划中专门用于Bro开发的赠款，美国国家超级计算应用中心（NCSA）作为该团队的核心合作伙伴加入了该计划。现如今Bro团队现在正在努力通过进一步提高系统功能来应对未来网络的挑战，以此取得成功。

## 2 Architecture

![](https://raw.githubusercontent.com/QGrain/picgo-bed/master/figure/architecture.png)

由上图可知Zeek的体系结构主要分为两个部分：

- **事件引擎：**Event Engine 将传入的数据包流减少为一系列更高级别的*events*。这些事件以与策略无关的术语反映了网络活动，它描述已看到的内容，但不对现象进行解释或分析。例如它能将线路上的HTTP request都转化为一个相应的`http_request`事件，该事件包含了请求的IP，端口和URL以及http version等信息。**但是Event Engine不会对此事件进一步解读，如该URL是否对应于已知的恶意站点。**
- **策略脚本解释器：**上例中的事件语义解析将由Zeek的第二个主要组件Policy Script Interpreter派生。该脚本解释器执行一组Zeek自定义脚本语言编写的**事件处理程序**来对事件进行语义分析。例如一个站点的安全策略将包括监测器检测到不同活动时应该做出的响应等。最重要的是，Zeek允许其脚本随着时间推移而保持工作状态，从而使它们能够跟踪并关联跨连接和主机边界观察到的内容的演变。Bro脚本可以生成实时警报，还可以按需执行任意外部程序，例如触发对攻击的主动响应。

## 3 Features

Zeek支持很多基于其脚本的分析，并且即便是不采用自定义脚本，它也能具备以下强大的功能特性：

- **Deployment**
  - 在标准Unix-Style的商用硬件上运行
  - 能对来自网络分接头或者监测端口的流量进行完全被动的流量分析
  - 用于捕获数据包的标准libpcap接口
  - 实时和离线分析
  - 对于大规模部署支持集群化，且无论是独立还是集群都采用统一的管理框架
  - BSD许可下开源
- **Analysis**
  - 全面记录活动，以进行离线分析和取证
  - 独立与应用层协议的端口分析
  - 支持许多应用程序层协议（包括DNS，FTP，HTTP，IRC，SMTP，SSH，SSL）
  - 分析通过应用层协议交换的文件内容，包括用于指纹识别的MD5 / SHA1计算
  - 全面的IPv6支持
  - 隧道检测和分析（包括Ayiya，Teredo，GTPv1）。Zeek将隧道解封装，然后继续分析其内容，就像没有隧道一样
  - 在协议分析过程中进行全面的健全性检查
  - 支持IDS样式的模式匹配

- **Scripting Language**
  - 图灵完备的语言，用于表达任意分析任务
  - 基于事件的编程模型
  - 特定于域的数据类型，例如IP地址（透明地处理IPv4和IPv6），端口号和计时器
  - 支持基于时间的跟踪和管理网络状态

- **Interfacing**
  - 默认输出到格式良好的ACSII日志
  - `ElasticSearch`和`DataSeries`的备用后端，并将后续支持其它数据接口
  - 外部输入实时集成到分析中，并将后续支持实时数据库的输入
  - 外部的C库用于与外部程序交换Zeek的事件，同样支持与Perl，Python和Ruby的绑定
  - 能够从脚本语言内部触发任意外部进程